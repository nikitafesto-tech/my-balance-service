{% extends "layouts/base.html" %}

{% block title %}Neirosetim AI{% endblock %}

{% block head_scripts %}
    {# --- 1. Глобальные библиотеки --- #}
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    {# --- 2. ПОДКЛЮЧАЕМ ГЛАВНЫЙ СКРИПТ (бывший chat.js) --- #}
    {# Теперь он грузится на всех страницах #}
    <script src="{{ url_for('static', path='js/chat.js') }}"></script>
{% endblock %}

{% block content %}
{# --- 3. ИНИЦИАЛИЗАЦИЯ: Запускаем приложение глобально --- #}
<div x-data="chatApp()" 
     data-balance="{{ balance | default(0) }}" 
     data-user-id="{{ user_id }}"
     class="flex h-screen w-full overflow-hidden bg-bg">
    
    {# Сайдбар теперь работает везде, так как он внутри chatApp #}
    {% include "components/_sidebar.html" %}

    <div class="flex-1 flex flex-col min-w-0 relative h-full">
        {% include "components/_header.html" %}
        
        <main class="flex-1 relative overflow-hidden flex flex-col">
            {# Контент конкретной страницы (Чат, Профиль или Главная) #}
            {% block app_content %}{% endblock %}
        </main>
    </div>

    {# Затемнение фона для мобильных #}
    <div x-show="sidebarOpen" 
         @click="sidebarOpen = false"
         x-transition.opacity
         class="fixed inset-0 z-30 bg-black/50 md:hidden backdrop-blur-sm"
         x-cloak>
    </div>
</div>
{% endblock %}